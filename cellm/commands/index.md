---
description: Rebuild and maintain the patterns index file (index.yml)
---

# Index Patterns

Rebuild and maintain the patterns index file (`index.yml`).

## Purpose

The index enables `/inject-patterns` to suggest relevant patterns without reading all files. It maps each pattern to a brief description for quick matching.

## Process

### Step 1: Scan for Pattern Files

1. List all `.md` files in `cellm-core/patterns/` and its subfolders
2. Build a list of all patterns organized by category:
   ```
   core/typescript-core.md
   core/vue-core.md
   core/nuxt-api.md
   anti/prohibited-code.md
   anti/prohibited-patterns.md
   ```

### Step 2: Load Existing Index

Read `cellm-core/patterns/index.yml` if it exists. Note which entries already have descriptions.

### Step 3: Identify Changes

Compare the file scan with the existing index:

- **New files** — Pattern files without index entries
- **Deleted files** — Index entries for files that no longer exist
- **Existing files** — Already indexed, keep as-is

### Step 4: Handle New Files

For each new pattern file that needs an index entry:

1. Read the file to understand its content
2. Use AskUserQuestion to propose a description:

```
New pattern needs indexing:
  File: core/api-response.md

Suggested description: "API response envelope structure and error format"

Accept? (yes / or type a better description)
```

Keep descriptions to **one short sentence** — they're for matching, not documentation.

### Step 5: Handle Deleted Files

If there are index entries for files that no longer exist:

1. List them for the user
2. Remove them from the index automatically (no confirmation needed)

Report: "Removed 2 stale index entries: core/old-pattern.md, anti/deprecated.md"

### Step 6: Write Updated Index

Generate `cellm-core/patterns/index.yml` with this structure:

```yaml
# CELLM Patterns Index
# Auto-generated by /index-patterns

core:
  typescript-core:
    description: Type guards, strict typing, utility types, generics
  typescript-fetch:
    description: $fetch typing, API response handling, error types
  vue-core:
    description: Component patterns, props validation, composables
  nuxt-api:
    description: API route patterns, server middleware, $fetch usage
  nuxt-ssr:
    description: SSR patterns, hydration, client/server separation
  tailwind:
    description: Utility classes, component styling, dark mode

anti:
  prohibited-code:
    description: Banned code patterns (any, console.log in prod)
  prohibited-patterns:
    description: Architecture anti-patterns to avoid
  prohibited-libs:
    description: Libraries not allowed in this project
  prohibited-nav:
    description: Navigation patterns to avoid
```

**Rules:**
- Alphabetize categories (anti, core)
- Alphabetize files within each category
- File names without `.md` extension
- One-line descriptions only

### Step 7: Report Results

Summarize what changed:

```
Index updated:
  [+] 2 new entries added
  [-] 1 stale entry removed
  [=] 15 entries unchanged

Total: 16 patterns indexed
```

## When to Run

- After manually creating or deleting pattern files
- If `/inject-patterns` suggestions seem out of sync
- To clean up a messy or outdated index

**Note:** `/discover-patterns` runs this automatically as its final step.

## Output

Updates `cellm-core/patterns/index.yml`

## Index Format Reference

```yaml
# Category name (folder)
category-name:
  # Pattern file (without .md)
  pattern-name:
    # One-line description for matching
    description: Brief description of what this pattern covers
```

## Integration

This command integrates with:

- **/discover-patterns** — Calls this automatically after creating patterns
- **/inject-patterns** — Reads index for auto-suggest mode
- **Oracle** — Can sync index with Oracle patterns table for semantic search
